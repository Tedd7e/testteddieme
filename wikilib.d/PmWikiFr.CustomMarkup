version=pmwiki-2.2.82 ordered=1 urlencoded=1
author=Petko
charset=UTF-8
csum=despam
ctime=1144012389
description=Ajout d'une nouvelle syntaxe
name=PmWikiFr.CustomMarkup
rev=8
targets=PmWikiFr.BalisesPersonnalisées,Profiles.Pm,PmWikiFr.DocumentationIndex
text=(:title Balises personnalisées:)(:description Ajout d'une nouvelle syntaxe:)%0aLa traduction des balises PmWiki est définie par un ensemble de règles; chaque règle fait une recherche sur une syntaxe spécifique dans le texte avec balises et remplace celui-ci par un autre texte. De manière interne, ceci est fait en utilisant la fonction PHP "[[(http://www.php.net/)preg_replace]]".%0a%0aLes règles sont ajoutées au moteur de traduction via la fonction de `PmWiki ''Markup()'', qui est définie comme%0a%0a   Markup($name,$when,$pattern,$replace)%0a%0aou [@$name@] est un nom unique (une chaîne) donnée à la règle, [@$when@] dit à quel moment la règle doit être appliquée relativement aux autres règles, [@$pattern@] est la syntaxe à rechercher dans le texte à balises, et [@$replace@] est ce qui doit remplacer la syntaxe trouvée.%0a%0aPar exemple, le code qui crée la règle pour [@''l'emphase d'un texte''@] (dans ''scripts/stdmarkup.php''):%0a%0a   [=Markup("em","inline","/''(.*?)''/","%3cem>$1%3c/em>");=]%0a%0aCette définition crée une règle appelée "em" qui sera exécutée avec les autres balises "inline", et la règle remplace tout texte entre deux paires de guillemets simples avec le même texte ($1) encadré par [@%3cem>@] et [@%3c/em>@].%0a%0aLes deux premiers paramètres de la fonction Markup() sont utilisés pour spécifier l'ordre dans laquelle les règles doivent s'appliquer. Le premier paramètre fournit un nom pour la règle -- "[@em@]" dans l'exemple ci-dessus. Nous aurions pu choisirs d'autres noms comme "[@''@]", ou même "[@deuxguillemetssimples@]".  En général `PmWiki utilise la balise elle-même pour nommer la règle (c.a.d., `PmWiki utilise "[@''@]" au lieu de "[@em@]"), mais pour faciliter la lecture de cet exemple, on utilise un nom mémorisable.%0a%0aLe second paramètre dit que la règle doit être utilisée en même temps que les autres règles de balises "inline".  `PmWiki découpe la méthode de traduction en un certain nombre de phases:%0a%0a   _begin          début de la traduction%0a   fulltext        la traduction est faite sur tout le texte %0a   split           découpage du texte à balises en lignes%0a   directives      exécution des directives%0a   inline          balises 'inline'%0a   links           conversion des [=[[liens]]=], liens-url, et [=MotsWiki=]  %0a   block           balises de blocs%0a   style           manipulation du style %0a   _end            fin de la traduction%0a%0aDonc, spécifier "inline" pour le second paramètre dit que cette règle doit être appliquée dans la même phase que les autres règles "inline". Si nous voulons une règle qui soit exécutée avec les directives -- c.a.d., avant que les règles 'inline' soient exécutées, nous aurions spécifié "directives" pour le second paramètre.%0a%0aIci une règle pour le texte [@@@monospaced@@@]%0a%0a   [=Markup("@@","inline","/@@(.*?)@@/","%3ccode>$1%3c/code>");=]%0a%0aet pour une directive [@(:comment ...:)@] qui est simplement enlevée de la sortie:%0a%0a   [=Markup("comment","directives","/\\[:comment .*?:\\]/",'');=]%0a%0aOk, maintenant à propos de la règle pour [@'''strong emphasis'''@]?  Nous devons être prudents ici, parce que même si cette règle est appliquée dans la même séquence que les autres balises 'inline', nous devons aussi être surs que la règle pour [@'''@] est exécutée ''avant'' la règle pour [@''@], parce que [@'''@] contient aussi [@''@]. Le second paramètre de Markup() peut être utilisé pour spécifier les relations de cette nouvelle règle par rapport aux autres:%0a%0a   [=Markup("strong","%3cem","/'''(.*?)'''/","%3cstrong>$1%3c/strong>");          =] %0a%0aCeci crée un règle appelée "strong", et le second paramètre "%3cem" dit que cette règle doit être exécutée avant la règle "em" définie plus haut. Si nous voulons exécuter une chose après la règle "em", nous utilisons ">em" à la place. Donc, il est possible d'ajouter des règles à tout moment dans la séquence de traduction de balises de PmWiki, ceci d'une manière extensive. (En fait, les séquences "inline", "block", "directives", etc., sont justes des règles de positionnement utilisées pour donner une séquence générale pour les autres règles. Donc on peut utiliser "%3cinline" pour spécifier les règles qui doivent être exécutées avant les autres règles "inline".).     %0a%0aSi vous voulez désactiver les balises disponibles, créez une ligne du genre :%0a%0a   Markup("strong","%3cem");           %0a%0aL'absence de paramètres de syntaxe indique que vous voulez désactiver la balise.        %0a%0aLes règles de balises par défaut de `PmWiki sont définies dans le fichier ''scripts/stdmarkup.php''. Pour voir la table de traduction complète pendant que le programme tourne, le module scripts/diag.php fournit "[@?action=ruleset@]", qui affiche l'ensemble des règles de balises dans l'ordre d'exécution. Vous pouvez voir ceci dans [[BalisesPersonnalisées?action=ruleset]].%0a%0a-----%0aVoici deux exemples que beaucoup de sites doivent se poser et qu'il n'est pas facile de résoudre. Dans ces deux cas, j'ai commencé par autoriser les balises HTML nécessaires, mais cela créait un trou dans la sécurité. Je suis donc venu aux balises personnalisées.%0a%0a'''Balise Xiti'''%0a%0a[[http://www.Xiti.com | Xiti]] est un système de statistiques mis à disposition des internautes gratuitement (pour les sites sans but très lucratif, ou en cours de démarrage), qui repose sur l'affichage d'un logo. L'appel de ce logo contient, entre autres, le nom de la page que l'on souhaite tracer.%0a%0aSi le navigateur n'accepte pas les Javascripts, il s'agit d'un simple appel %3cIMG>. Si les scripts sont acceptés, d'autres informations sont récupérées (taille de l'écran, page d'origine).%0a%0aDans les pages à tracer, ajouter l'instruction [=(:xiti `{$FullName}:)=]. Noter que [=$FullName=] est le nom complet de la page (on peut mettre autre chose, si l'on veut). Important&nbsp;: Ne pas oublier l'anti-quote avant l'accolade (sinon, c'est interprété comme un lien et des balises HTML sont rajoutées)&nbsp;! Astuce&nbsp;: Mettre cette instruction dans la barre de navigation évite de mettre la balise dans toutes les pages%0a%0aDans le fichier config.php, inclure le code suivant (remplacer XXXXXX par le code client fourni par Xiti)&nbsp;: ''Note&nbsp; Certaines lignes ont été coupées Merci de recoller les morceaux&nbsp;!''%0a->[@%0aMarkup('xiti', '>block', '/\\(:xiti (.*?):\\)/', '%0a%3ca href="http://www.xiti.com/xiti.asp?s=XXXXXX" title="Mesurez votre audience">%0a%3cscript type="text/javascript">%0a%3c!--%0aXt_param = \'s=210790&p=$1\';%0aXt_r = document.referrer;%0aXt_h = new Date();%0aXt_i = \'%3cimg width="39" height="25" border="0" \';%0aXt_i += \'src="http://logv28.xiti.com/hit.xiti?\'+Xt_param;%0aXt_i += \'&hl=\'+Xt_h.getHours()+\'x\'+Xt_h.getMinutes()+\'x\'+Xt_h.getSeconds();%0aif(parseFloat(navigator.appVersion)>=4)%0a{Xt_s=screen;Xt_i+=\'&r=\'+Xt_s.width+\'x\'+Xt_s.height+\'x\'+Xt_s.pixelDepth+\'x\'+X%0at_s.colorDepth;}%0adocument.write(Xt_i+\'&ref=\'+Xt_r.replace(/[%3c>"]/g, \'\').replace(/&/g, \'$\')+\'" t%0aitle="Analyse d\\\'audience">\');%0a//-->%0a%3c/script>%0a%3cnoscript>%0a%3cimg width="39" height="25" src="http://logv28.xiti.com/hit.xiti?s=XXXXXX&p=$1" alt="A%0analyse d\'audience">%0a%3c/noscript>%0a%3c/a>');%0a@]%0a-%3c%0a%0a->%25note%25Une question reste à résoudre&nbsp;: Si [=$FulName=] est un [=MotWiki=], cela fonctionne bien. Mais si ce n'est pas le cas, l'antiquote est conservée et apparaît dans le nom de la page.\\%0aPour la partie [=JavaScript=], l'on peut s'en sortir ainsi&nbsp;:%0a[@%0aXt_i += \'src="http://logv28.xiti.com/hit.xiti?\'+Xt_param.replace(/`/, \'\');%0a@]%0a->%25note%25Pour la partie %3cnoscript>, je n'ai pas encore trouvé%0a-%3c%0a%0a'''Balise [[http://www.PayPal.com | PayPal]]'''%0a%0a[[http://www.PayPal.fr | PayPal France]] est la division française de [[http://www.PayPal.com | PayPal]] et permet d'effectuer des transferts électroniques d'argent en toute (?) sécurité. Il est très fréquent de mettre un bouton "Faire un don" qui permet, sur un site gratuit, de laisser une contribution.%0a%0aLorsque l'on souhaite faire un don, [[http://www.PayPal.com | PayPal]] fournit un code %3cFORM> pour déclencher l'affichage de la page ad hoc sur leur site, en ayant déjà prérempli les informations utiles.%0a%0aVoici l'exemple que j'ai mis sur mon site (merci à [=Hans=], l'auteur de [=FixFlow=], qui m'a envoyé sa version)&nbsp;:%0a->[@%0aMarkup('paypal', '>block', '/\\(:paypal consowiki:\\)/', '%0a%3cform action="https://www.paypal.com/cgi-bin/webscr" method="post" />%0a%3cinput type="hidden" name="cmd" value="_xclick" />%0a%3cinput type="hidden" name="business" value="Finance@consowiki.org" />%0a%3cinput type="hidden" name="item_name" value="ConsoWiki" />%0a%3cinput type="hidden" name="page_style" value="PayPal" />%0a%3cinput type="hidden" name="no_shipping" value="1" />%0a%3cinput type="hidden" name="return" value="http://ConsoWiki.org/index.php?n=ConsoWiki.M%0aerci" />%0a%3cinput type="hidden" name="cancel_return" value="http://ConsoWiki.org/index.php?n=Cons%0aoWiki.Dommage" />%0a%3cinput type="hidden" name="currency_code" value="EUR" />%0a%3cinput type="hidden" name="tax" value="0" />%0a%3cinput type="hidden" name="lc" value="FR" />%0a%3cinput type="hidden" name="bn" value="PP-DonationsBF" />%0a%3cinput type="image" src="https://www.paypal.com/fr_FR/i/btn/x-click-but04.gif" border="%0a0" name="submit" alt="Effectuez vos paiements via PayPal&nbsp;: une solution rapide, gr%0aatuite et sécurisée&nbsp;!" />%0a%3c/form />');%0a@]%0a-%3c%0a-----%0aLes questions et mises à jour au sujet de cette page sont vivement appréciées, vous pouvez les envoyer à [[~Pm]], pmwiki-users (en anglais).%0a%0a----%0a%25trail%25%3c%3c|[[DocumentationIndex|+]]|>>%0a
time=1450267851
title=Balises personnalisées
