version=pmwiki-2.2.30 ordered=1 urlencoded=1
author=Bigpoon
charset=UTF-8
csum=
ctime=1273981562
name=PmWikiZhTw.UploadsAdmin
rev=9
targets=PmWiki.PmWiki,PmWikiZhTw.Uploads,PmWikiZhTw.Security,PmWikiZhTw.WikiAdministrator,PmWikiZhTw.PasswordsAdmin,PmWikiZhTw.Passwords,Cookbook.UploadGroups,PmWikiZhTw.GroupCustomizations,PmWikiZhTw.LocalCustomizations,Cookbook.UploadTypes,Cookbook.SecureAttachments,PmWikiZhTw.WikiGroup,PmWikiZhTw.PageDirectives,Cookbook.AttachlistEnhanced,Cookbook.PreventHotlinking
text=(:title 上傳管理:)%0a(:Summary:Administration of PmWiki [[uploads]]:)%0a[[PmWiki]] 包括一個 ''upload.php''腳本允許用戶使用Web瀏覽器 [[upload(s)]] 文件到wiki服務器。上傳文件(也稱為 ''附件'')可以很容易地訪問wiki頁面內使用的標記。本頁面描述了如何安裝和配置上傳功能。%0a%0a%0a!! 關於 [[security]]的注意事項：%0a%0aPmWiki takes a somewhat, but justifiable, paranoid stance%0awhen it comes to the uploads feature.  Thus, the default settings for%0auploads tend to try to restrict the feature as much as possible:%0a%0a* 上傳功能在默認情況下是關閉的%0a* 即使啟用它, 默認設置還是有密碼保護%0a* 即使您刪除了密碼, 上傳文件還是限制了一些檔案名稱、類形及大小%0a* 上傳的附件名稱（默認）出現'''數字, 連字符, 下劃線, 點和空格'''為被限制類形([[#restrictinguploadedfiles| 參見這裡]]).%0a* 上傳的附件最大檔案大小（默認情況下是50K）%0a%0a以上情況的潛在危險是有限的 %0a除非維基管理員明確放寬了限制%0a%0a請記住，讓用戶（匿名！）上傳文件到你的Web服務器會存在一些額外的風險。  ''upload.php'' 腳本設計，是減少危害，  [[wiki administrator]]s 應該知道潛在的安全漏洞會存在， 上傳工具設置錯誤可能導致不必要的後果。%0a%0a預設情況下，被授權用戶可以覆寫已經上傳的文件，但不可以恢復以前的文件, 如果你想禁止用戶覆寫已經存在的文件，可在''config.php''添加以下行 :%0a%0a->[@$EnableUploadOverwrite = 0;@]%0a%0a另外，管理員可以 [[#upload_versions|keep older versions]] 的上傳%0a%0a管理員還可以 [[#direct_download|configure]] PmWiki密碼機制，控制上傳文件的權限%0a%0a%0a!!基本安裝%0a%0a''upload.php'' 腳本已經自動包含在 ''stdconfig.php'' ，真正的 $EnableUpload 變數是在 ''config.php''裏面。 ''config.php'' 可以設置 $UploadDir and $UploadUrlFmt 變量來指定本地目錄上傳文件應存放和網址，可用於訪問該目錄。 默認情況下, $UploadDir and $UploadUrlFmt 假設上傳將存儲在一個名為  ''uploads/'' 的文件夾裏， 當前目錄（通常是一個包含 ''pmwiki.php'')。此外， ''config.php'' 中也應設置一個默認的上傳密碼 (見 [[PasswordsAdmin]]).%0a%0a因此，一個基本設置上傳的''config.php''如下所示：%0a%0a->[@%0a%3c?php if (!defined('PmWiki')) exit();%0a##  Enable uploads and set a site-wide default upload password.%0a$EnableUpload = 1;%0a$DefaultPasswords['upload'] = crypt('secret');%0a@]%0a%0a如果你有修改密碼，並希望允許所有用戶上傳與編輯的權利，而不是 $DefaultPasswords['upload']，您可以在config.php 中設置 @@$HandleAuth['upload'] = 'edit';@@ .%0a%0a'''重要''': 不要自行創建的上傳目錄！參見下一段。%0a%0a您可能還需要設置文件系統目錄再進行上傳，並提供一個 URL對應到該目錄，如:%0a%0a->[@%0a$UploadDir = "/home/foobar/public_html/uploads";%0a$UploadUrlFmt = "http://example.com/~foobar/uploads";%0a@]%0a%0a[[#uploaddirectoryconfiguration]]%0a!!! Upload directory configuration%0aUploads can be configured ''site-wide'', ''by-group'' (default), or ''by-page'' by changing $UploadPrefixFmt in @@config.php@@.  %0aThis determines whether all uploads go in one directory for the site, an individual directory for each group, or an individual directory for each page.  The default is to organize upload by group. %0a[[%3c%3c]]%0a''建議設置 $UploadPrefixFmt 變量盡量在 config.php 同一路徑的頁面，而不是在不同的組或頁面本地配置文件。否則你''' 將''' 無法鏈接到其他wikigroups附件。''%0a%0a!!!!單檔案上傳%0a[[#sitewideprefix]]For site-wide uploads, use%0a%0a->[@$UploadPrefixFmt = '';@]%0a%0a!!!!單文件上傳%0aTo organize uploads by page, use:%0a%0a->[@$UploadPrefixFmt = '/$Group/$Name';@]%0a%0a!!!上傳目錄%0a%0a對於上傳功能能正常運作，該目錄 [=$UploadDir=] 必須為可寫入的Web服務器進程，它通常設置在網站一個可以訪問的位置（例如，在一個子目錄的''public_html'')。執行PmWiki與上傳啟用會提示你設置的步驟與要求，以創建您的服務器上傳目錄（它不同於一台服務器到下）。 注意，你可能需要顯式地創建可寫的組或頁面具體子目錄的！ (it differs from one server to the next). ''Note that you are likely to be required to explicitly create writable group- or page-specific subdirectories as well!''%0a%0a%0a!!!上傳文件%0a%0a一旦啟用上傳功能，用戶上傳形式可在加入正常PmWiki URL 後面加上"@@?action=upload@@"。用戶將被提示輸入密碼，上載的方式類似其他網頁要求輸入密碼 (見 [[Passwords]]及[[PasswordsAdmin]]有關設置密碼在頁面、groups和整個網站的信息)。 %0a%0a另一種上傳方式是在表單插入標記 "[@Attach:filename.ext@]" 到一個現有的頁面。在這裡 filename.ext是名稱的一個新的文件進行上傳。當頁面顯示，'?-link'鏈接'將被添加到結束的標記以筆者的上傳頁面。) ( 語法的變化見[[Uploads]]%0a%0a默認情況下，PmWiki將組織上傳文件到每個組獨立的子目錄。這可以修改 $UploadPrefixFmt變量。見 [[Cookbook:UploadGroups]]。%0a%0a%0a!! [[#upload_versions]] 上傳版本文件%0a%0aPmWiki不管理版本上傳文件默認情況下。但是，通過設置$EnableUploadVersions=1; 管理員可以有舊版本的上傳保存在上傳目錄以及最新的版本。%0a%0a!! 上傳限制%0a!!! 限制上傳的文件、groups和網頁%0a%0aUploads can be enabled only for specific groups or pages by using a [[group customization(s)]].  Simply set @@$EnableUpload=1;@@ for those groups or pages where uploading is to be enabled; alternately, set @@$EnableUpload=1;@@ in the config.php file and then set @@$EnableUpload=0;@@ in the per-group or per-page customization files where uploads are to be disabled.%0a%0a!!! Restricting total upload size for a group or the whole wiki%0a%0aUploads can be restricted to an overall size limit for groups.  In the group configuration file (i.e., local/Group.php), add the line%0a%0a->$UploadPrefixQuota = 1000000;    # limit group uploads to 1000KB (1MB)%0a%0aThis will limit the total size of uploads for that group to 1000KB --any upload that pushes the total over the limit will be rejected with an error message.  This value defaults to zero (unlimited).%0a%0aUploads can also be restricted to an overall size limit for all uploads.  Add the line%0a%0a->$UploadDirQuota = 10000000;    # limit total uploads to 10000KB (10MB)%0a%0aThis will limit the total size of uploads for the whole wiki to 10000KB --any upload that pushes the total over the limit will be rejected with an error message.  This value defaults to zero (unlimited).%0a%0a%0a[[#restrictinguploadedfiles]]%0a!!!限制上傳的文件類型和大小%0a%0aThe upload script performs a number of verifications on an uploaded file before storing it in the upload directory.  The basic verifications are described below.%0a:'''文件名''': the name for the uploaded file can contain only letters, digits, underscores, hyphens, spaces, and periods, and the name must begin and end with a letter or digit.  %0a:'''文件擴展名''': only files with approved extensions such as "@@.gif@@", "@@.jpeg@@", "@@.doc@@", etc. are allowed to be uploaded to the web server.  This is vitally important for server security, since the web server might attempt to execute or specially process files with extensions like "@@.php@@", "@@.cgi@@", etc.  %0a:'''文件大小''': 默認情況下所有上傳被限制為 50K bytes, 作為指定的 $UploadMaxSize 變量。因此，將所有上傳限制到100KB, 只需在 ''config.php'' 指定一個新 $UploadMaxSize 值 :%0a%0a->[@$UploadMaxSize = 100000;@]%0a%0a然而，文件大小限制也可以指定每種類型的上傳文件.  因此，管理員可以限制 "@@.gif@@" 及 "@@.jpeg@@" 類形文件至 20K, "@@.doc@@" 文件到 200K, 和所有其他的大小給予 $UploadMaxSize。$UploadExtSize 數組用於確定哪些文件擴展名是有效的和最大上傳大小(in bytes) 為每個文件類型。例如:%0a%0a->[@$UploadExtSize['gif'] = 20000; # limit .gif files to 20KB@]%0a%0aSetting an entry to zero disables file uploads of that type altogether:%0a%0a->[@%0a$UploadExtSize['zip'] = 0;  # disallow .zip files%0a$UploadExtSize[''] = 0;     # disallow files with no extension@]%0a%0aYou can limit which types of files are uploadable by disabling all defaults and specifying only desired types%0aSetting the variable $UploadMax to zero will disable all default file types. Individual file types may then be enabled by setting their maximum size with the variable $UploadExtSize.%0a%0a-> [@# turns off all upload extensions%0a$UploadMaxSize = 0;%0a%0a# enable only these file types for uploading%0a$aSize=100000; // 100 KB file size limitation%0a$UploadExtSize['jpg' ] = $aSize;%0a$UploadExtSize['gif' ] = $aSize;%0a$UploadExtSize['png' ] = $aSize;%0a@]%0a%0a[[#newuploadfiletypes]]%0a!! Adding new file types to permitted uploads%0a%0aTo add a new extension to the list of allowed upload types, add a line like the following to a [[local customization(s)]] file:%0a%0a->[@$UploadExts['ext'] = 'content-type';@]%0a%0awhere ''ext'' is the extension to be added, and ''content-type'' is the "[[(Wikipedia:)MIME type]]", or content-type (which you may find %25newwin%25[[http://www.iana.org/assignments/media-types/ | here]] or on the lower part of %25newwin%25[[http://www.w3schools.com/media/media_mimeref.asp | this page]]) to be used for files with that extension.  For example, to add the '[@dxf@]' extension with a Content-Type of '[@image/x-dxf@]', place the line%0a%0a->[@$UploadExts['dxf'] = 'image/x-dxf';@]%0a%0aEach entry in $UploadExts needs to be the extension and the%0amime-type associated with that extension, thus:%0a%0a->[@%0a$UploadExts = array(%0a  'gif' => 'image/gif',%0a  'jpeg' => 'image/jpeg',%0a  'jpg' => 'image/jpeg',%0a  'png' => 'image/png',%0a  'xxx' => 'yyyy/zzz'%0a);%0a@]%0a%0aFor the types that PmWiki already knows about it's not necessary to repeat them here (the ''upload.php'' script adds PmWiki's defaults to whatever the administrator supplies).%0a[[#newuploadfiletypesend]]%0aSee also Cookbook:UploadTypes for additional types.%0a%0a[[#otherfilesizelimits]]%0a!!Other file size limits%0a%0aThere are other factors involved that affect upload file sizes.  In Apache 2.0, there is a `[[http://httpd.apache.org/docs/2.2/mod/core.html#limitrequestbody|LimitRequestBody]] directive that controls the maximum size of anything that is posted (including file uploads).  Apache has this defaulted to unlimited size.  However, some Linux distributions (e.g., Red Hat Linux) limit postings to 512K so this may need to be changed or increased.  (Normally these settings are in an ''httpd.conf'' configuration file or in a file in ''/etc/httpd/conf.d''.)%0a%0aProblem noted on Red Hat 8.0/9.0 with Apache 2.0.x, the error "Requested content-length of 670955 is larger than the configured limit of 524288" was occurring under Apache and a "Page not found" would appear in the browser. Trying the above settings made no change with PHP, but on Red Hat 8.0/9.0 there is an additional PHP config file, /etc/httpd/conf.d/php.conf, and increasing the number on the line "`LimitRequestBody 524288" solves the issue.%0a%0aPHP itself has two limits on file uploads (usually located in @@/etc/php.ini@@).  The first is the @@upload_max_filesize@@ parameter, which is set to 2MB by default.  The second is @@post_max_size@@, which is set to 6MB by default.%0a%0aWith the variables in place--PmWiki's maximum file size, Apache's request-size limits, and the PHP file size parameters, the maximum uploaded file size will be the smallest of the three variables.%0a%0a!!! [[#direct_download]] Password protecting uploaded files%0aSetting a  read password for pages (and groups) will prevent an attached file from being seen or accessed through the page, but to prevent direct access to the file location (the uploads/ directory) one can do the following:%0a %0a* In local/config.php set @@$EnableDirectDownload=0@@;%0a* If you use per-group upload directories (PmWiki default, see $UploadPrefixFmt), add to config.php @@$EnableUploadGroupAuth = 1;@@%0a* Deny public access to the uploads/ directory through moving it out of the html/ or public_html/ directory tree, or through a .htaccess file.%0a%0a%0aSee [[Cookbook:Secure attachments]] {Cookbook.SecureAttachments$:Summary}%0a%0a%0a!! 其它事項%0a%0a* 如果上傳功能無法使用，請確認您的PHP系統支援上傳功能：在 ''php.ini'' 檔案中 (通常在 ''/etc/php.ini'' 或 ''/usr/local/lib/php.ini'' 的位置) 必須包含：  %0a%0a->[@file_uploads = On@]%0a%0a* 另一個錯誤的原因是：在 ''php.ini'' 檔案中，未定義''upload_tmp_dir''。   例如：可將此變數設定為暫存資料夾，輸入： %0a%0a->[@upload_tmp_dir = /tmp@]%0a%0a%0a請注意，當您更改以上數值後，通常必須重新啟動httpd。另一個檢查的方法是設定 ''config.php''檔案中， $EnableDiag 值為 1 。並在URL中輸入%0a %0a[@?action=phpinfo@] %0a %0a"@@file_uploads@@" 變數數值應該為1 (如果顯示 "@@no value@@" 則表示上傳關閉)。%0a%0a%0a%0a%0a>>faq%3c%3c [[#faq]]%0a%0aQ: 如何禁用上傳某一類型的文件?%0aA: 下面是一個例子，如何添加到您的 ''local/config.php'' 禁用上傳的 .zip 文件。或沒有擴展名的文件:%0a%0a->[@%0a$UploadExtSize['zip'] = 0;  # Disallow uploading .zip files%0a$UploadExtSize[''] = 0;     # Disallow files with no extension@]%0a%0aQ: How do I attach uploads to individual pages or the entire site, instead of organizing them by [[wiki group]]?%0aA: Use the $UploadPrefixFmt variable (see also the Cookbook:UploadGroups recipe).%0a%0a->[@$UploadPrefixFmt = '/$FullName';  # per-page@]%0a->[@$UploadPrefixFmt = '';   # site-wide@]%0a%0aQ:For $UploadDirQuota - can you provide some units and numbers?  Is the specification in bytes or bits? What is the number for 100K? 1 Meg? 1 Gig? 1 Terabyte?%0aA: Units are in bytes. %0a%0a   $UploadDirQuota = 100*1024;         # limit uploads to 100KiB%0a   $UploadDirQuota = 1000*1024;        # limit uploads to 1000KiB%0a   $UploadDirQuota = 1024*1024;        # limit uploads to 1MiB%0a   $UploadDirQuota = 25*1024*1024;     # limit uploads to 25MiB%0a   $UploadDirQuota = 2*1024*1024*1024; # limit uploads to 2GiB%0a%0aQ: 我可以上傳不使用unicode檔名，或者其他編碼之檔名的文件嗎？ %0aA: 可以，參見 $UploadNameChars%0a%0aQ: 附件名單會被儲存在哪裡?%0aA: It is generated on the fly by the [[PageDirectives#attachlist|(:attachlist:)]] markup.%0a%0aQ: 我如何才能找到遺失的附件%0aA: 參見 [[Cookbook:Attachlist enhanced]] {Cookbook.AttachlistEnhanced$:Summary}%0a%0aQ: 我要如何防止我上傳的圖片被盜連(hotlinking)？%0aA: 見 [[Cookbook:Prevent Hotlinking]] {Cookbook.PreventHotlinking$:Summary}%0a%0aQ: 我設置''config.php''中文件上傳大小為8MB，但為何只能上傳小於2MB的文件？%0aA: 請檢查您的 php.ini 中 ''upload_max_filesize''%0a->[@%0aupload_max_filesize = 8M%0a@]%0a%0a若您無法更動''php.ini''檔案，請直接改動server中的''.htaccess''檔案：%0a%0a->[@php_value post_max_size 63M%0aphp_value upload_max_filesize 62M%0aphp_value memory_limit 64M%0aphp_value max_execution_time 600%0aphp_value default_socket_timeout 600%0a@]
time=1315680534
title=上傳管理
