version=pmwiki-2.2.129 ordered=1 urlencoded=1
author=kavya
charset=UTF-8
csum= (-11)
ctime=1497756367
name=PmWiki.SetupHTTPS
rev=29
targets=PmWiki.InitialSetupTasks,PmWiki.PathVariables,Cookbook.SwitchToSSLMode
text=(:Summary:Setup PmWiki for HTTP over Transport Layer Security:)%0a%0aThe internet community is rapidly moving to ensuring all %25newwin%25[[https://support.google.com/webmasters/answer/6073543?hl=en|websites are secure]] by using Hypertext Transfer Protocol Secure (HTTPS). %0a%0aNote that %25newwin%25[[https://webmasters.googleblog.com/2014/08/https-as-ranking-signal.html|HTTPS]] and [[https://support.google.com/adsense/answer/6196932?hl=en|mobile friendly]] are used as ranking signals by search engines.%0a%0aThis page is a placeholder or work in progress, serving to amalgamate information from the email list and recipes to where it should be held in the main PmWiki pages.%0a%0a!! HTTPS request handling by PmWiki%0aPmWiki '''already''' responds properly to https: requests -- it detects when a request comes in via HTTPS and converts its outgoing links accordingly.%0a%0aThe sample @@config.php@@ contains:%0a->[@# $ScriptUrl = 'http://www.mydomain.com/path/to/pmwiki.php'; @]%0a->[@# $PubDirUrl = 'http://www.mydomain.com/path/to/pub'; @]%0aTo force all pmwiki links to use https change this to:%0a->[@  $ScriptUrl = 'https://'.$_SERVER['HTTP_HOST'].'/pmwiki/pmwiki.php'; @]%0a->[@  $PubDirUrl = 'https://'.$_SERVER['HTTP_HOST'].'/pmwiki/pub'; @]%0a%0aChances are that a site is already setting $ScriptUrl in the local/config.php anyway -- it's one of the first things mentioned in @@docs/sample-config.php@@, and in the [[initial setup tasks]] documentation.%0a%0aI'd be fine with updating docs/sample-config.php to include something like:%0a->[@# If you prefer HTTPS over HTTP linkages:%0a   # $UrlScheme = 'https';%0a   # $ScriptUrl = 'https://www.mydomain.com/path/to/pmwiki.php';%0a   # $PubDirUrl = 'https://www.mydomain.com/path/to/pub'; @]%0a%0a%0a!! PmWiki to automatically redirect HTTP to HTTPS%0aTo have PmWiki automatically redirect incoming HTTP requests to be a HTTPS request... that sounds recipe-ish.  %0aAnd it's much more efficient for it to be handled at the webserver level anyway (e.g., vis .htaccess, Redirect, etc.)%0a%0aAt the beginning of @@config.php@@ add, for versions of PmWiki after 2.2.0-beta18%0a>>frame%3c%3c%0a->[@if ($UrlScheme == 'http') {%0a  header( "Location: " . "https://" . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'] );%0a  exit('%3chtml>%3cbody>%0a    %3ca href="https://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'] . '">Please use HTTPS%3c/a>%0a    %3c/body>%3c/html>');%0a}%0a$ScriptUrl = "https://".$_SERVER['HTTP_HOST']."/pmwiki/pmwiki.php";%0a$PubDirUrl = 'https://'.$_SERVER['HTTP_HOST'].'/pmwiki/pub';@]%0a>>%3c%3c%0a%0a!! Certificate%0aA certificate from a Certificate Authority is required, a self-signed certificate is no longer adequate'^%25newwin%25[[https://www.thoughtco.com/signed-vs-self-signed-certificates-3469534|#]]^'.%0a* [[https://letsencrypt.org/|Letâ€™s Encrypt]] is a free, automated, and open Certificate Authority%0a** EFF's [[https://certbot.eff.org/|CertBot]] for automatically enabling HTTPS on your PmWiki deploying Let's Encrypt certificates.%0a** [[https://certifytheweb.com/ | Certify the Web]] provides a Windows native client to acquire and install a Let's Encrypt certificate %0a%0a!! Using .htacccess for HTTPS%0aCreate, or add to, an @@.htaccess@@ file in the @@public_html@@ directory.%0aAdd the lines%0a->[@RewriteEngine On%0aRewriteCond %25{HTTPS} off%0aRewriteRule ^(.*)$ https://%25{HTTP_HOST}%25{REQUEST_URI} [L,R=301] @]%0aEnsure the @@RewriteEngine On@@ is not repeated twice.'^%25newwin%25[[https://www.hostinger.com/tutorials/ssl/forcing-https|#]]^'%0a%0a!! Setup HTTPS on IIS%0aThe following steps will assist in getting PmWiki working with [[https://support.microsoft.com/en-nz/help/324069/how-to-set-up-an-https-service-in-iis|HTTPS on IIS]].%0a* Follow the steps above to enable HTTPS in PmWiki and acquire a SSL Certificate.%0a* In IIS select the server, and Sever Certificates%0a** if your certificate is not already shown here (e.g. from LetsEncrypt) import it%0a** Enable %25newwin%25[[https://docs.microsoft.com/en-us/iis/get-started/whats-new-in-iis-85/certificate-rebind-in-iis85|Automatic Rebind]] of Renewed Certificate%0a* In IIS select the website to secure%0a** choose the Binding action, add a binding of Type @@https@@ for your Host Name, then select the SSL certificate to use%0aYou can also %25newwin%25[[https://www.namecheap.com/support/knowledgebase/article.aspx/9953/38/setting-up-an-httphttps-redirect-in-iis|redirect]] your http traffic to https.%0a%0a!! Also check%0a* your router is set to allow port 443 (HTTPS) traffic%0a* your firewall is set to allow HTTPS (port 443) traffic%0a* IIS SSL settings are set to Client certificates: ignore%0a%0a!! A Simpler Way%0aYou can simply do this as well, I have been using for some time now:%0a%0a->[@  $ScriptUrl = '//your-host-name.com/pmwiki/pmwiki.php'; @]%0a->[@  $PubDirUrl = '//your-host-name.com/pmwiki/pub'; @]%0a%0aYou just have to remove the 'http:' or 'https:' altogether, but this will remove compatibility with older browsers and some PmWiki recipes, like googledocviewer, be careful.%0a%0a%0a!! References%0a* [[Cookbook:SwitchToSSLMode]]%0a* [[PmWikiUsers:2017-June/063852.html]]%0a* [[PmWikiUsers:2017-May/063842.html]]%0a* [[PmWikiUsers:2017-February/063703.html]]%0a* [[PmWikiUsers:2017-February/063711.html]]%0a* [[PmWikiUsers:2017-February/063700.html]]%0a* [[https://serverguy.com/security/redirect-http-to-https/ | How to Redirect HTTP to HTTPS using .htaccess File?]]
time=1591432255
