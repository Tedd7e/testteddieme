version=pmwiki-2.2.145 ordered=1 urlencoded=1
author=abd
charset=UTF-8
csum=
ctime=1144515664
description=Activer et configurer l'envoi de fichiers
name=PmWikiFr.UploadsAdmin
rev=11
targets=PmWikiFr.WikiAdministrator,PmWiki.UploadVariables,PmWikiFr.PasswordsAdmin,PmWiki.SecurityVariables,PmWikiFr.Passwords,PmWikiFr.Uploads,PmWikiFr.DocumentationIndex,!UpdateMe,Category.UpdateMe
text=(:title Administration des fichiers joints:)(:description Activer et configurer l'envoi de fichiers:)%0a(:ResteAFaire:Page à revoir:)%0a%25vert%25 La traduction de cette page est à vérifier%0a%0aPmWiki possède une fonction codée dans @@upload.php@@ qui permet  aux utilisateurs de transférer des fichiers sur le serveur wiki à partir d'un navigateur. Ces fichiers peuvent aisément être rendus accessibles en utilisant un code dans les pages wiki. Cette page décrit comment mettre en place et configurer les transferts de fichiers.%0a%0a%0a!!!Quelques notes à propos de sécurité.%0a%0a1.  Garder à l'esprit que permettre aux utilisateurs (anonymement !) de télécharger des fichiers sur votre serveur web entraîne un certain nombre de risques. Le script @@upload.php@@ a été conçu pour minimiser les risques, mais les [[administrateurs du Wiki->WikiAdministrator]] devraient être conscients que le potentiel de vulnérabilités existe, et qu'une mauvaise configuration de l'utilitaire de téléchargement peut aboutir à des conséquences indésirables.%0a%0a2.  Par défaut, les utilisateurs autorisés peuvent écraser les fichiers téléchargés auparavant, sans possibilité de restaurer la version précédente de ces fichiers. Si vous ne voulez pas permettre aux utilisateurs d'écraser les fichiers déjà transférés, ajoutez la ligne suivante dans votre ''config.php'':%0a%0a    $EnableUploadOverwrite = 0;%0a%0a!!!Base de l'installation%0a%0aLe script ''upload.php'' est automatiquement inclus depuis le fichier ''stdconfig.php'' si la variable @@$EnableUpload@@ est activée dans ''config.php''. De plus, dans ''config.php'' on peut configurer les variables  @@$UploadDir@@ et @@$UploadUrlFmt@@ pour préciser le dossier où les fichiers devraient être stockés, et l'URL qui peut être utilisée pour accéder à ce dossier. Par défaut, @@$UploadDir@@ et @@$UploadUrlFmt@@ suppose que les fichiers seront enregistrés dans un dossier nommé ''uploads'' situé dans le répertoire courant (usuellement celui qui contient ''pmwiki.php''). De plus, ''config.php'' devrait aussi contenir le mot de passe par défaut pour tout téléchargement (voir [[PasswordsAdmin|+]]).%0a%0aAussi, un fichier ''config.php'' de base paramétré pour le téléchargement devrait ressembler à ça:%0a    %0a    %3c?php%0a      $EnableUpload = 1;%0a      $UploadDir = "/home/john/public_html/uploads";%0a      $UploadUrlFmt = [="http://www.john.com/~john/uploads";=]%0a      $DefaultPasswords['upload'] = crypt('secret');%0a      ## options de configuration additionnelles ici...%0a    ?>%0a%0aPour que les transferts fonctionnent correctement, le dossier désigné par @@[=$UploadDir=]@@ doit être accessible en écriture par le processus du serveur web, et il doit être situé à un endroit publiquement accessible à partir du web (par ex., dans un sous-dossier de ''public_html''). L'[[administrateur du Wiki->WikiAdministrator]] peut soit créer ce dossier manuellement, ou soit laisser à Pmwiki le soin de le créer lorsque celui-ci est exécuté avec l'option de téléchargement activée (@@$EnableUpload = 1@@ dans config.php). Pour que PmWiki puisse créer le dossier, (1) changez les permissions du dossier parent à 2777, (2) lancer PmWiki avec la fonctionnalité de téléchargement activée, (3) vérifiez que le dossier upload est créé, et (4) rétablissez les permissions du dossier parent à leur valeur initiale (755 en général est une valeur sûre).  %0a%0aPar exemple, pour que le dossier upload soit installé dans "@@/home/john/public_html/uploads@@", il faudrait faire "@@chmod 2777 /home/john/public_html@@", lancer  ''pmwiki.php'', s'assurer que le dossier upload soit bien créé ("@@ls /home/john/public_html@@"), et rétablir les permissions normales du dossier parent ("@@chmod 755 /home/john/public_html@@").%0a%0aUne fois les transferts de fichiers mis en route, les utilisateurs peuvent accéder au formulaire des téléchargements en ajoutant "?action=upload" à la fin d'une URL normale de PmWiki. Un mot de passe pour effectuer le transfert sera alors demandé aux utilisateurs de la même manière quand d'autres pages requièrent un mot de passe pour d'autres permissions (voir [[Passwords|+]] et [[PasswordsAdmin|+]] pour savoir comment établir des mots de passe sur des pages, des groupes, ou sur le site globalement).%0a %0aUne autre façon d'accéder au formulaire de téléchargement est d'insérer le code "@@[=Attach:filename.ext=]@@" dans une page existante, où @@filename.ext@@ est le nom du fichier à transférer. Quand la page est affichée, un '?-lien' est ajouté à la fin de l'attachement et envoie l'auteur à la page des téléchargements.%0a%0aPar défaut, `PmWiki organise les fichier téléchargés dans des sous-dossiers séparés pour chaque groupe. Ceci peut être changer en modifiant la variable @@$UploadPrefixFmt@@.%0a%0a!!! Restrictions sur les fichiers téléchargés%0a%0aLe scripte ''upload.php'' effectue un certain nombre de vérifications sur un fichier téléchargé avant de l'enregistrer dans le dossier upload. Ces vérifications sont décrites ci-dessous. %0a%0a'''noms de fichier''' -  le nom pour un fichier téléchargé peut être composé de lettres, de chiffres, de soulignés (underscore), de traits d'union et de points et il doit commencer et se terminer par une lettre ou un chiffre.%0a%0a'''extension de fichier''' - seuls les fichiers avec des extensions volontairement approuvées[[Uploads|#]] telles que ".gif", ".jpg", ".doc", etc. sont autorisés à être transférer sur le serveur web. Ceci est d'une importance capitale pour la sécurité du serveur, car celui-ci pourrait essayer d'exécuter ou de traiter spécifiquement des fichiers avec de extensions comme ".php", ".cgi", etc. %0a%0a'''taille des fichiers''' - Par défaut ''upload.php'' limite tous les téléchargements à 50K de part la valeur spécifiée dans la variable @@$UploadMaxSize@@. Aussi pour pousser cette limite de tous les transferts à 100K, spécifiez simplement dans local/config.php%0a%0a    $UploadMaxSize = 100000; %0a%0aCependant, ''upload.php'' permet de préciser la taille maximum des fichiers pour chaque type de téléchargement. Ainsi, un administrateur peut restreindre les ".gif" et les ".jpeg" à 20K, les ".doc"%0aà 200K, et tous les autres à la taille indiquée par @@$UploadMaxSize@@. Le tableau de variables @@$UploadExtSize@@ est utilisé pour déterminer quelles sont les extensions valides et quelle est la taille maximum (en octets) pour chaque type de fichier. Par exemple:%0a%0a    $UploadExtSize['gif'] = 20000;      # limite les fichiers .gif à 20K%0a%0aParaméter une entrée à zéro désactive complètement le téléchargement d'un type de fichier:%0a%0a    $UploadExtSize['zip'] = 0;          # interdit le transfert des fichiers .zip%0a%0aUn autre tableau de variables appelé  @@$UploadExts@@ est utilisé pour remplir @@$UploadExtSize@@ avec les extensions qui devraient être limitées à la valeur d'@@$UploadMaxSize@@. Par défaut, @@$UploadExts@@ contient un certain nombre d'extensions de fichier populaires (et sûrs), mais cela peut être changé par un administrateur qui voudrait limiter sévèrement les téléchargements par types.  Par exemple:%0a%0a    {-$UploadExts = array('gif','jpeg','jpg','png','ppt');-} // cette ligne n'aura aucun effet de restriction%0a    $UploadMaxSize = 20000;%0a    $UploadExtSize['ppt'] = 150000;%0a    $UploadExtSize['doc'] = 150000;%0a%0adefini dans local/config.php autorise {-seulement-} les fichiers GIF, JPEG et PNG jusqu'à 20K, les fichers `PowerPoint et Word jusqu'à 150K, {-et interdit tous les autres types-}.%0a%0aPour interdire une extension autorisée par défaut[[Uploads|#]], il faut remplir la variable @@$UploadBlacklist@@, par exemple :%0a%0a    $UploadBlacklist = array ('.bmp', '.cgi', '.exe', '.fla', '.hqx','.htm','.swf');%0a%0aDeux autres facteurs sont impliqués dans l'affection de la limite de taille des fichiers transférés. Dans Apache 2.0, la directive  @@[=LimitRequestBody=]@@ contrôle la taille maximum de tout ce qui est posté (les téléchargments inclus). Initialement dans Apache, cette taille est illimitée. Pourtant, certaines distributions Linux incluant Red Hat fixent cette limite à 512K aussi il peut être nécessaire de la changer ou de l'augmenter. Pour ce faire il suffit d'éditer le fichier config.php localisé dans votre dossier de configuration d'Apache (la plupart du temp dans /etc/httpd/conf.d).%0a%0aPHP lui même possède deux limites sur les fichiers téléchargés. La première est le paramètre de taille maxi d'un fichier transféré (upload_max_size), fixé à 2M par défaut. Le second est la taille maxi d'un post (post_max_size), fixé à 6M par défaut.%0a%0aAvec les variables en jeu--taille maximum de transfert de PmWiki, la limite de taille des requêtes d'Apache, et les paramètres de taille de fichier propre à PHP, la taille maximum autorisée sera la plus petite de ces trois paramètres. %0a%0a!!!Autres notes%0a%0a*Notez que l'accès en lecture aux fichiers transférés n'est contrôlé par aucune des permissions de page ou de groupe--les fichiers transférés sont accessibles même si les pages sont protégées en lecture par un mot de passe.%0a%0a----%0a%0a'''Question'''  La variable $UploadExts = array('gif','jpeg','jpg','png','ppt'); ne marche pas. Quelqu'un peut-il m'aider?\\%0a'''''Reponse''''' : La fonction SDVA() utilisé pour remplir $UploadExts dans le script ''upload.php'' rajoutera toutes les extensions prévues par défaut qui n'auront pas été déjà mentionnée dans le fichier de config.php.\\%0aOn peut au contraire ajouter des extensions à autoriser qui ne le serait pas par défaut en faisant :\\%0a     $UploadExts = array('.monExtensionARajouter' => 'mime_type_appropie');%0a%0a----%0a%25trail%25%3c%3c|[[DocumentationIndex|+]]|>>%0a%0a[[!UpdateMe]]%0a
time=1640242085
title=Administration des fichiers joints
